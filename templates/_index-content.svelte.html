
<div class="strib-styles ssa ssb ssc">
  <div class="hero">
    <h1>The Non-Profit 100</h1>

    <p class="lead container-sm">The 23rd annual Star Tribune top non-profits in Minnesota.</p>

    <div class="byline">
      <address>By <a rel="author" href="http://startribune.com//patrick-kennedy/10645186/">Patrick Kennedy</a></address>
      <span class="spacer"></span>
      Star Tribune
      <span class="spacer-alt"></span>
      <time pubdate datetime="2018-12-16T00:00:00">December 16, 2018</time>
    </div>

    <div class="share-placeholder">
      <!-- share -->
    </div>
  </div>

  <div class="container-lg">
    <div class="category-filter">
      <form>
        <div class="row">
          <div class="col col-100 col-md-66">
            <fieldset>
              <legend>Filter <span class="sr-only">company list</span></legend>

              {#each categories as f}
                <button type="button" class="category { f.id } { categoryFilter === f.id ? 'active' : '' }" on:click="proxySet(event, { categoryFilter: f.id })">{ f.name }</button>
              {/each}
            </fieldset>
          </div>

          <div class="col col-100 col-md-33">
            <div class="ceo-sort">
              {#if (!ceoSort)}
                <button on:click="proxySet(event, { ceoSort: true })" type="button" class="sort-ceo">Sort by CEO compensation</button>
              {:else}
                <button on:click="proxySet(event, { ceoSort: false })" type="button" class="unsort-ceo">Sort by revenue rankings</button>
              {/if}
            </div>
          </div>
      </form>
    </div>

    <div class="company-list">
      {#each filteredNonProfits as company}
        <Company
          {...company}
          publishYear="{ publishYear }"
          ceoTitleMatch="{ ceoTitleMatch }"
        />
      {/each}
    </div>

    <footer class="article-footer">
      <h1>Credits</h1>

      <ul class="credits">
        <li>Data collected by Patrick Kennedy</li>
        <li>Design and development by Alan Palazzolo, Jamie Hutt, and Billy Steve Clayton</li>
      </ul>

      <h1>Methodology</h1>

      <p>Certain nonprofits, charities and charitable trusts registered with the state must file IRS Form 990 with the Minnesota attorney general's office each year. Most of the financial information for organizations on our list was taken from their 2017 Form 990s or from consolidated audited financial statements. The Star Tribune's list includes the top officer and that person's total compensation, including salary, bonus and incentive compensation, other reportable compensation, contributions to retirement and other deferred compensation plans, and the value of nontaxable benefits.</p>
    </footer>
  </div>
</div>

<script>
  import Company from "./_company.svelte.html";
  import { cloneDeep, sortBy, filter, kebabCase, find } from "lodash";

  export default {
    components: {
      Company
    },

    computed: {
      filteredNonProfits({
        nonprofits,
        categoryFilter,
        ceoSort,
        publishYear,
        ceoTitleMatch
      }) {
        let copy = cloneDeep(nonprofits);

        // Filter
        if (categoryFilter) {
          copy = filter(copy, c => {
            return kebabCase(c.category) === categoryFilter;
          });
        }

        // Sort
        if (ceoSort) {
          copy = sortBy(copy, c => {
            return c.ceo && c.ceo.salary ? c.ceo.salary.total || 0 : 0;
          }).reverse();
        } else {
          copy = sortBy(copy, c => {
            return c.rank;
          });
        }

        return copy;
      }
    },

    methods: {
      proxySet(event, toSet) {
        if (event && event.preventDefault) {
          event.preventDefault();
        }

        if (toSet) {
          this.set(toSet);
        }
      }
    },

    data() {
      return {
        filter: undefined,
        categories: [
          { id: undefined, name: "All" },
          { id: "social-services", name: "Social services" },
          { id: "healthcare", name: "Healthcare" },
          { id: "arts", name: "Arts" },
          { id: "education", name: "Education" },
          { id: "other", name: "Other" }
        ]
      };
    }
  };
</script>
